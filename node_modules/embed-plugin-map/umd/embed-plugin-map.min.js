!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.embedPluginMap=e()}(this,function(){"use strict";function n(){var e=[].slice.call(arguments),r=!1;"boolean"==typeof e[0]&&(r=e.shift());var t=e[0];if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Error("extendee must be an object");for(var u=e.slice(1),o=u.length,i=0;i<o;i++){var c=u[i];for(var a in c)if(c.hasOwnProperty(a)){var f=c[a];if(r&&function(n){return Array.isArray(n)||"[object Object]"=={}.toString.call(n)}(f)){var s=Array.isArray(f)?[]:{};t[a]=n(!0,t.hasOwnProperty(a)?t[a]:s,f)}else t[a]=f}}return t}function e(n,e){var r=n.map(function(n){return function(n,e){var r=n.concat([n.index,n.input]);return e.apply(null,r).then(function(e){return s({},n,{replacement:e})})}(n,e)});return Promise.all(r)}function r(n,r,t){r.lastIndex=0;try{return Promise.resolve(function(n,r,t){return e(function(n,e){for(var r=[],t=e.exec(n);t&&(r.push(t),e.global);)t=e.exec(n);return r}(n,r),t).then(function(e){return function(n,r){return e.reverse().reduce(function(n,e){var r=n.slice(0,e.index),t=n.slice(e.index+e[0].length);return r+e.replacement+t},n)}(n)})}(n,r,t))}catch(n){return Promise.reject(n)}}function t(n,e,r){return void 0===r&&(r=!1),r?n.test(e):e.match(n)}function u(n,e){var r=n.result,t=n.plugins;void 0===t&&(t=[]);return function(n){return new RegExp("<a[^>]*>("+n.source+")<\\/a>","gi")}(e.regex).test(r)||t.filter(function(n){return"url"===n.id}).length}function o(n,e,r){var t=n._services,u=e.id;t.filter(function(n){return n.match===r}).length||t.push({id:u,match:r})}function i(n,e,t,u){return new Promise(function(i,a){var f,s;return s=t,f=s.regex,r(n,f,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,i){return c(n,e,t).then(function(c){try{return e._embeds.push({content:c,index:u||n.find(function(n){return"number"==typeof n})}),o(e,t,n[0]),r()}catch(n){return i(n)}},i)})}).then(function(n){try{return i(e)}catch(n){return a(n)}},a)})}function c(n,e,r){var t=this;return new Promise(function(u,o){function i(){return u(a(n,e,r,f))}var c,a,f,s;return s=r,c=s._process,a=s.template,c?c(n,e,r).then(function(n){try{return f=n,i.call(t)}catch(n){return o(n)}},o):i.call(t)})}function a(n,e){var r=e.fetch;return new Promise(function(e,t){var u,o,i;return u=n[1],r("http://maps.googleapis.com/maps/api/geocode/json?address="+u+"&sensor=false").then(function(n){try{return(o=n).json().then(function(n){try{return i=n,e(i.results[0].geometry.location)}catch(n){return t(n)}},t)}catch(n){return t(n)}},t)})}function f(n){var e=s({},{id:d,regex:/@\((.+)\)/gi,mode:"place",height:300,gAuthKey:"",template:function(n,e,r,t){var u=r.mode,o=r.gAuthKey,i=r.height,c=t.lat,a=t.lng;return new Promise(function(e,r){var t,f=n[1],s="https://www.google.com/maps/embed/v1/"+u+"?key="+o;return"place"===u?t=s+"&q="+f:"streetview"===u?t=s+"&location="+c+","+a+"&heading=210&pitch=10&fov=35":"view"===u&&(t=s+"&center="+c+","+a+"&zoom=18&maptype=satellite"),e(m(t,i,d))})}},n,{_process:a,_ignoreAnchorCheck:!0});return p(e)}var s=n,l=/<a[^>]*>([^<]+)<\/a>/gi,h=function(n,e){return new Promise(function(a,f){var h,m,p,d,g;h=n.inlineEmbed;var v;return v=e,m=v._ignoreAnchorCheck,p=v._ignoreInlineCheck,d=v.regex,h||p?new Promise(function(i,a){return u(n,{regex:d})&&!m?function(n,e){return new Promise(function(u,i){var a=n.result,f=n.replaceUrl,s=e.regex,h=e._replaceAnyways;return u(r(a,l,function(u,i){return new Promise(function(a,l){var m,p;return t(s,i,!0)?f||h?a(r(i,s,function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];return new Promise(function(t,u){return o(n,e,r[0]),t(c(r,n,e))})})):(m=function(n,e){n.lastIndex=0;var r=n.exec(e);return n.lastIndex=0,r}(s,i),o(n,e,m[0]),c(m,n,e).then(function(n){try{return p=n,a(m?u+p:u)}catch(n){return l(n)}},l)):a(u)})}))})}(n,e).then(i,a):function(n,e){return new Promise(function(t,u){var i=n.result,a=n.replaceUrl,f=e.regex,s=e._replaceAnyways;return t(r(i,f,function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];return new Promise(function(t,u){return o(n,e,r[0]),new Promise(function(t,u){return a||s?t(c(r,n,e)):c(r,n,e).then(function(n){try{return t(r[0]+" "+n)}catch(n){return u(n)}},u)}).then(t,u)})}))})}(n,e).then(i,a)}).then(function(e){try{return g=e,a(s({},n,{result:g}))}catch(n){return f(n)}},f):a(function(n,e){var c=this;return new Promise(function(a,f){function h(){return a(p)}var m,p,d;return d=e,m=d.regex,p=s({},n),u(p,{regex:m})?r(p.result,l,function(n,r,u){return new Promise(function(c,a){return t(m,n,!0)?(o(p,e,n),i(r,p,e,u).then(function(e){try{return p=e,c(n)}catch(n){return a(n)}},a)):c(n)})}).then(function(n){try{return h.call(c)}catch(n){return f(n)}},f):(p=i(p.result,p,e),h.call(c))})}(n,e))})},m=function(n,e,r){return'<iframe class="ejs-embed ejs-'+r+'" src="'+n+'" frameBorder="0" height="'+e+'"></iframe>'},p=function(n){var e=s({},{_replaceAnyways:!1,_ignoreAnchorCheck:!1,_ignoreInlineCheck:!1,onLoad:function(){}},n),r=e._onLoadInternal,t=e.onLoad,u=e.regex,o=e.template,i=e.id;if(!u)throw new Error("regex not passed.");if(!o)throw new Error("template not passed.");return{id:i,transform:function(n){return new Promise(function(r,t){return h(n,e).then(function(e){try{return r(s({},n,e))}catch(n){return t(n)}},t)})},onLoad:function(n){r&&r(n,e),t&&t(n,e)}}},d="map";return f.id="map",f});
//# sourceMappingURL=embed-plugin-map.min.js.map
