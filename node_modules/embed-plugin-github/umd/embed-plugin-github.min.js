!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.embedPluginGithub=r()}(this,function(){"use strict";function n(){var r=[].slice.call(arguments),e=!1;"boolean"==typeof r[0]&&(e=r.shift());var t=r[0];if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Error("extendee must be an object");for(var u=r.slice(1),i=u.length,o=0;o<i;o++){var c=u[o];for(var a in c)if(c.hasOwnProperty(a)){var f=c[a];if(e&&function(n){return Array.isArray(n)||"[object Object]"=={}.toString.call(n)}(f)){var s=Array.isArray(f)?[]:{};t[a]=n(!0,t.hasOwnProperty(a)?t[a]:s,f)}else t[a]=f}}return t}function r(n,r){var e=n.map(function(n){return function(n,r){var e=n.concat([n.index,n.input]);return r.apply(null,e).then(function(r){return s({},n,{replacement:r})})}(n,r)});return Promise.all(e)}function e(n,e,t){e.lastIndex=0;try{return Promise.resolve(function(n,e,t){return r(function(n,r){for(var e=[],t=r.exec(n);t&&(e.push(t),r.global);)t=r.exec(n);return e}(n,e),t).then(function(r){return function(n,e){return r.reverse().reduce(function(n,r){var e=n.slice(0,r.index),t=n.slice(r.index+r[0].length);return e+r.replacement+t},n)}(n)})}(n,e,t))}catch(n){return Promise.reject(n)}}function t(n,r,e){return void 0===e&&(e=!1),e?n.test(r):r.match(n)}function u(n,r){var e=n.result,t=n.plugins;void 0===t&&(t=[]);return function(n){return new RegExp("<a[^>]*>("+n.source+")<\\/a>","gi")}(r.regex).test(e)||t.filter(function(n){return"url"===n.id}).length}function i(n,r,e){var t=n._services,u=r.id;t.filter(function(n){return n.match===e}).length||t.push({id:u,match:e})}function o(n,r,t,u){return new Promise(function(o,a){var f,s;return s=t,f=s.regex,e(n,f,function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return new Promise(function(e,o){return c(n,r,t).then(function(c){try{return r._embeds.push({content:c,index:u||n.find(function(n){return"number"==typeof n})}),i(r,t,n[0]),e()}catch(n){return o(n)}},o)})}).then(function(n){try{return o(r)}catch(n){return a(n)}},a)})}function c(n,r,e){var t=this;return new Promise(function(u,i){function o(){return u(a(n,r,e,f))}var c,a,f,s;return s=e,c=s._process,a=s.template,c?c(n,r,e).then(function(n){try{return f=n,o.call(t)}catch(n){return i(n)}},i):o.call(t)})}function a(n,r){var e=r.fetch;return new Promise(function(r,t){var u,i,o,c;u=(c=n)[1],i=c[2];var a=function(n){try{return r({})}catch(n){return t(n)}};try{return e("https://api.github.com/repos/"+u+"/"+i).then(function(n){try{return o=n,r(o.json())}catch(n){return a()}},a)}catch(n){a()}})}function f(n){var r=s({},{id:p,regex:/[^\.]github.com\/([\w\.\-]+)\/([\w\.\-]+[^\.])/gi,template:function(n,r,e,t){var u=t.owner,i=t.description,o=t.html_url,c=t.full_name;return new Promise(function(n,r){return n(v({thumbnail:u.avatar_url,url:o,description:i,title:c}))})}},n,{_process:a});return m(r)}var s=n,l=/<a[^>]*>([^<]+)<\/a>/gi,h=function(n,r){return new Promise(function(a,f){var h,d,v,m,p;h=n.inlineEmbed;var g;return g=r,d=g._ignoreAnchorCheck,v=g._ignoreInlineCheck,m=g.regex,h||v?new Promise(function(o,a){return u(n,{regex:m})&&!d?function(n,r){return new Promise(function(u,o){var a=n.result,f=n.replaceUrl,s=r.regex,h=r._replaceAnyways;return u(e(a,l,function(u,o){return new Promise(function(a,l){var d,v;return t(s,o,!0)?f||h?a(e(o,s,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new Promise(function(t,u){return i(n,r,e[0]),t(c(e,n,r))})})):(d=function(n,r){n.lastIndex=0;var e=n.exec(r);return n.lastIndex=0,e}(s,o),i(n,r,d[0]),c(d,n,r).then(function(n){try{return v=n,a(d?u+v:u)}catch(n){return l(n)}},l)):a(u)})}))})}(n,r).then(o,a):function(n,r){return new Promise(function(t,u){var o=n.result,a=n.replaceUrl,f=r.regex,s=r._replaceAnyways;return t(e(o,f,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new Promise(function(t,u){return i(n,r,e[0]),new Promise(function(t,u){return a||s?t(c(e,n,r)):c(e,n,r).then(function(n){try{return t(e[0]+" "+n)}catch(n){return u(n)}},u)}).then(t,u)})}))})}(n,r).then(o,a)}).then(function(r){try{return p=r,a(s({},n,{result:p}))}catch(n){return f(n)}},f):a(function(n,r){var c=this;return new Promise(function(a,f){function h(){return a(v)}var d,v,m;return m=r,d=m.regex,v=s({},n),u(v,{regex:d})?e(v.result,l,function(n,e,u){return new Promise(function(c,a){return t(d,n,!0)?(i(v,r,n),o(e,v,r,u).then(function(r){try{return v=r,c(n)}catch(n){return a(n)}},a)):c(n)})}).then(function(n){try{return h.call(c)}catch(n){return f(n)}},f):(v=o(v.result,v,r),h.call(c))})}(n,r))})},d=function(n,r,e){return null==r||r>=n.length?n:(null==e&&(e="..."),n.slice(0,Math.max(0,r-e.length))+e)},v=function(n,r,e){var t=n.url,u=n.title,i=n.embedUrl,o=n.description,c=n.thumbnail;return void 0===e&&(e=!1),'<div class="ejs-preview ejs-embed"><div class="ejs-thumb '+r+'" data-url="'+i+'" style="background-image:url('+c+')">'+(e?"<span>&#9658;</span>":"")+'</div><div class="ejs-info"><h4 class="ejs-title"><a href="'+t+'">'+u+'</a></h4><div class="ejs-desc">'+d(o,150)+"</div></div></div>"},m=function(n){var r=s({},{_replaceAnyways:!1,_ignoreAnchorCheck:!1,_ignoreInlineCheck:!1,onLoad:function(){}},n),e=r._onLoadInternal,t=r.onLoad,u=r.regex,i=r.template,o=r.id;if(!u)throw new Error("regex not passed.");if(!i)throw new Error("template not passed.");return{id:o,transform:function(n){return new Promise(function(e,t){return h(n,r).then(function(r){try{return e(s({},n,r))}catch(n){return t(n)}},t)})},onLoad:function(n){e&&e(n,r),t&&t(n,r)}}},p="github";return f.id=p,f});
//# sourceMappingURL=embed-plugin-github.min.js.map
