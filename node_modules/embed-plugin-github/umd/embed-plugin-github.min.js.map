{"version":3,"file":"embed-plugin-github.min.js","sources":["../../../node_modules/just-extend/index.js","../../embed-plugin-utilities/src/string-replace-async.js","../../embed-plugin-utilities/src/insert.js","../src/index.js","../../../node_modules/just-truncate/index.js","../../embed-plugin-utilities/src/with-details-template.js","../../embed-plugin-base/src/index.js"],"sourcesContent":["module.exports = extend;\n\n/*\n  var obj = {a: 3, b: 5};\n  extend(obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 4, b: 5, c: 8}\n\n  var obj = {a: 3, b: 5};\n  extend({}, obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 3, b: 5}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3, 4]}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(true, obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3]}\n\n  extend({a: 4, b: 5}); // {a: 4, b: 5}\n  extend({a: 4, b: 5}, 3); {a: 4, b: 5}\n  extend({a: 4, b: 5}, true); {a: 4, b: 5}\n  extend('hello', {a: 4, b: 5}); // throws\n  extend(3, {a: 4, b: 5}); // throws\n*/\n\nfunction extend(/* [deep], obj1, obj2, [objn] */) {\n  var args = [].slice.call(arguments);\n  var deep = false;\n  if (typeof args[0] == 'boolean') {\n    deep = args.shift();\n  }\n  var result = args[0];\n  if (!result || (typeof result != 'object' && typeof result != 'function')) {\n    throw new Error('extendee must be an object');\n  }\n  var extenders = args.slice(1);\n  var len = extenders.length;\n  for (var i = 0; i < len; i++) {\n    var extender = extenders[i];\n    for (var key in extender) {\n      if (extender.hasOwnProperty(key)) {\n        var value = extender[key];\n        if (deep && isCloneable(value)) {\n          var base = Array.isArray(value) ? [] : {};\n          result[key] = extend(true, result.hasOwnProperty(key) ? result[key] : base, value);\n        } else {\n          result[key] = value;\n        }\n      }\n    }\n  }\n  return result;\n}\n\nfunction isCloneable(obj) {\n  return Array.isArray(obj) || {}.toString.call(obj) == '[object Object]';\n}\n","import extend from \"just-extend\"\n\nfunction matchAll(str, re) {\n  const matches = []\n  let res = re.exec(str)\n\n  while (res) {\n    matches.push(res)\n\n    if (!re.global) {\n      break\n    }\n\n    res = re.exec(str)\n  }\n  return matches\n}\n\nfunction replaceAll(str, matches) {\n  return matches.reverse().reduce(function(res, match) {\n    const prefix = res.slice(0, match.index)\n    const postfix = res.slice(match.index + match[0].length)\n\n    return prefix + match.replacement + postfix\n  }, str)\n}\n\nfunction assignReplacement(match, replacer) {\n  const args = match.concat([match.index, match.input])\n\n  return replacer.apply(null, args).then(function(res) {\n    return extend({}, match, { replacement: res })\n  })\n}\n\nfunction concurrency(matches, replacer) {\n  const promises = matches.map(function(match) {\n    return assignReplacement(match, replacer)\n  })\n\n  return Promise.all(promises)\n}\n\nfunction processString(str, re, replacer) {\n  const matches = matchAll(str, re)\n  const processor = concurrency\n\n  return processor(matches, replacer).then(function(matches) {\n    return replaceAll(str, matches)\n  })\n}\n\nfunction stringReplaceAsync(str, re, replacer) {\n  re.lastIndex = 0\n  try {\n    return Promise.resolve(processString(str, re, replacer))\n  } catch (e) {\n    return Promise.reject(e)\n  }\n}\n\nexport default stringReplaceAsync\n","import extend from \"just-extend\"\nimport stringReplaceAsync from \"./string-replace-async\"\n\nconst anchorRegex = /<a[^>]*>([^<]+)<\\/a>/gi\n\nfunction getAnchorRegex(regex) {\n  return new RegExp(`<a[^>]*>(${regex.source})<\\\\/a>`, \"gi\")\n}\n\n/**\n * Returns the matched regex data or whether the text has any matching string\n * @param regex Regex of the matching pattern\n * @param text String which has to be searched\n * @param test Return boolean or matching array\n * @returns {*} Boolean|Array\n */\nfunction isMatchPresent(regex, text, test = false) {\n  return test ? regex.test(text) : text.match(regex)\n}\n\n/**\n * Tells wheteher the matching string is present inside an anchor tag\n * @param text\n * @returns {*} Boolean\n * @param regex\n */\nfunction isAnchorTagApplied({ result, plugins = [] }, { regex }) {\n  return (\n    getAnchorRegex(regex).test(result) ||\n    plugins.filter(plugin => plugin.id === \"url\").length\n  )\n}\n\nfunction saveServiceName({ _services }, { id }, match) {\n  if (!_services.filter(x => x.match === match).length) {\n    _services.push({ id, match })\n  }\n}\n\nasync function pushEmbedContent(text, options, pluginOptions, index) {\n  const { regex } = pluginOptions\n  await stringReplaceAsync(text, regex, async (...args) => {\n    options._embeds.push({\n      content: await getTemplate(args, options, pluginOptions),\n      index: index || args.find(x => typeof x === \"number\")\n    })\n    saveServiceName(options, pluginOptions, args[0])\n  })\n  return options\n}\n\n/**\n * Save the embed code into an array that can be added later to the end of original string\n * @param opts\n * @param pluginOptions\n */\nasync function saveEmbedData(opts, pluginOptions) {\n  const { regex } = pluginOptions\n  let options = extend({}, opts)\n\n  if (isAnchorTagApplied(options, { regex })) {\n    await stringReplaceAsync(\n      options.result,\n      anchorRegex,\n      async (match, url, index) => {\n        if (!isMatchPresent(regex, match, true)) return match\n        saveServiceName(options, pluginOptions, match)\n        options = await pushEmbedContent(url, options, pluginOptions, index)\n        return match\n      }\n    )\n  } else {\n    options = pushEmbedContent(options.result, options, pluginOptions)\n  }\n\n  return options\n}\n\nfunction getMatch(regex, string) {\n  regex.lastIndex = 0\n  const matches = regex.exec(string)\n  regex.lastIndex = 0\n  return matches\n}\n\nasync function getTemplate(args, options, pluginOptions) {\n  const { _process, template } = pluginOptions\n  let data\n  if (_process) {\n    data = await _process(args, options, pluginOptions)\n  }\n  return template(args, options, pluginOptions, data)\n}\n\nasync function basicReplace(options, pluginOptions) {\n  const { result, replaceUrl } = options\n  const { regex, _replaceAnyways } = pluginOptions\n  return stringReplaceAsync(result, regex, async (...args) => {\n    saveServiceName(options, pluginOptions, args[0])\n    return replaceUrl || _replaceAnyways\n      ? getTemplate(args, options, pluginOptions)\n      : `${args[0]} ${await getTemplate(args, options, pluginOptions)}`\n  })\n}\n\nasync function anchorReplace(options, pluginOptions) {\n  const { result, replaceUrl } = options\n  const { regex, _replaceAnyways } = pluginOptions\n\n  return stringReplaceAsync(result, anchorRegex, async (match, url) => {\n    if (!isMatchPresent(regex, url, true)) {\n      return match\n    }\n\n    if (!(replaceUrl || _replaceAnyways)) {\n      const args = getMatch(regex, url)\n      saveServiceName(options, pluginOptions, args[0])\n      const t = await getTemplate(args, options, pluginOptions)\n      return args ? match + t : match\n    }\n    return stringReplaceAsync(url, regex, async (...args) => {\n      saveServiceName(options, pluginOptions, args[0])\n      return getTemplate(args, options, pluginOptions)\n    })\n  })\n}\n\n/**\n * Insert the embed code in the original string.\n * @param options\n * @param pluginOptions\n * @returns options\n */\nexport default async function(options, pluginOptions) {\n  const { inlineEmbed } = options\n  const { _ignoreAnchorCheck, _ignoreInlineCheck, regex } = pluginOptions\n\n  if (!inlineEmbed && !_ignoreInlineCheck) {\n    return saveEmbedData(options, pluginOptions)\n  }\n\n  let output\n\n  output =\n    isAnchorTagApplied(options, { regex }) && !_ignoreAnchorCheck\n      ? await anchorReplace(options, pluginOptions)\n      : await basicReplace(options, pluginOptions)\n\n  return extend({}, options, {\n    result: output\n  })\n}\n","import extend from \"just-extend\"\nimport base from \"embed-plugin-base\"\nimport { withDetailsTemplate } from \"embed-plugin-utilities\"\n\nconst id = \"github\"\n\nasync function _process(args, { fetch }) {\n  const [, user, repo] = args\n\n  try {\n    const res = await fetch(`https://api.github.com/repos/${user}/${repo}`)\n    return res.json()\n  } catch (e) {\n    return {}\n  }\n}\n\nexport default function github(opts) {\n  const defaultOptions = {\n    id,\n    regex: /[^\\.]github.com\\/([\\w\\.\\-]+)\\/([\\w\\.\\-]+[^\\.])/gi,\n\n    async template(\n      args,\n      options,\n      pluginOptions,\n      { owner, description, html_url, full_name }\n    ) {\n      return withDetailsTemplate({\n        thumbnail: owner.avatar_url,\n        url: html_url,\n        description,\n        title: full_name\n      })\n    }\n  }\n\n  const pluginOptions = extend({}, defaultOptions, opts, {\n    _process\n  })\n  return base(pluginOptions)\n}\n\ngithub.id = id\n","module.exports = truncate;\n\n/*\n  truncate('when shall we three meet again', 9); // 'when s...'\n  truncate('when shall we three meet again', 10, ' (etc)'); // 'when (etc)'\n  truncate('when shall we', 15,); // 'when shall we'\n  truncate('when shall we', 15, '(more)'); // 'when shall we'\n  truncate('when shall we', 7, ' (more)'); // ' (more)'\n*/\n\nfunction truncate(str, length, end) {\n  if (length == null || length >= str.length) {\n    return str;\n  }\n  if (end == null) {\n    end = '...';\n  }\n  return str.slice(0, Math.max(0, length - end.length)) + end;\n}\n","import truncate from \"just-truncate\"\n\nexport default function(\n  { url, title, embedUrl, description, thumbnail },\n  thumbClassName,\n  showPlayIcon = false\n) {\nreturn `<div class=\"ejs-preview ejs-embed\"><div class=\"ejs-thumb ${thumbClassName}\" data-url=\"${embedUrl}\" style=\"background-image:url(${thumbnail})\">${showPlayIcon ? '<span>&#9658;</span>' : ''}</div><div class=\"ejs-info\"><h4 class=\"ejs-title\"><a href=\"${url}\">${title}</a></h4><div class=\"ejs-desc\">${truncate(\n    description,\n    150\n  )}</div></div></div>`\n}\n","import extend from \"just-extend\"\nimport { insert } from \"embed-plugin-utilities\"\n\nexport default opts => {\n  const defaultOptions = {\n    _replaceAnyways: false,\n    _ignoreAnchorCheck: false,\n    _ignoreInlineCheck: false,\n    onLoad() {}\n  }\n\n  const pluginOptions = extend({}, defaultOptions, opts)\n\n  const { _onLoadInternal, onLoad, regex, template, id } = pluginOptions\n\n  if (!regex) {\n    throw new Error(\"regex not passed.\")\n  }\n  if (!template) {\n    throw new Error(\"template not passed.\")\n  }\n\n  return {\n    id,\n\n    async transform(options) {\n      return extend({}, options, await insert(options, pluginOptions))\n    },\n\n    onLoad(options) {\n      if (_onLoadInternal) {\n        _onLoadInternal(options, pluginOptions)\n      }\n      if (onLoad) {\n        onLoad(options, pluginOptions)\n      }\n    }\n  }\n}\n"],"names":["extend","args","slice","call","arguments","deep","shift","result","Error","extenders","len","length","i","extender","key","hasOwnProperty","value","obj","Array","isArray","toString","isCloneable","base","concurrency","matches","replacer","const","promises","map","match","concat","index","input","apply","then","res","replacement","assignReplacement","Promise","all","stringReplaceAsync","str","re","lastIndex","resolve","exec","push","global","matchAll","reverse","reduce","prefix","postfix","replaceAll","processString","e","reject","isMatchPresent","regex","text","test","isAnchorTagApplied","ref","ref$1","RegExp","getAnchorRegex","plugins","filter","plugin","id","saveServiceName","_services","x","pushEmbedContent","options","pluginOptions","getTemplate","_embeds","content","$await_7","find","template","data","_process","$await_11","fetch","user","repo","$await_2","json","github","opts","owner","description","html_url","full_name","withDetailsTemplate","thumbnail","avatar_url","url","title","anchorRegex","inlineEmbed","_ignoreAnchorCheck","_ignoreInlineCheck","replaceUrl","_replaceAnyways","string","getMatch","t","$await_14","anchorReplace","$await_12","basicReplace","output","$await_17","$await_9","saveEmbedData","end","Math","max","thumbClassName","showPlayIcon","embedUrl","truncate","onLoad","_onLoadInternal","transform","insert","$await_1"],"mappings":"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"}