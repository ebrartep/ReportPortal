!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.embedPluginUtilities={})}(this,function(e){"use strict";function n(){var e=[].slice.call(arguments),r=!1;"boolean"==typeof e[0]&&(r=e.shift());var t=e[0];if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Error("extendee must be an object");for(var u=e.slice(1),i=u.length,c=0;c<i;c++){var o=u[c];for(var a in o)if(o.hasOwnProperty(a)){var f=o[a];if(r&&function(e){return Array.isArray(e)||"[object Object]"=={}.toString.call(e)}(f)){var s=Array.isArray(f)?[]:{};t[a]=n(!0,t.hasOwnProperty(a)?t[a]:s,f)}else t[a]=f}}return t}function r(e,n){var r=e.map(function(e){return function(e,n){var r=e.concat([e.index,e.input]);return n.apply(null,r).then(function(n){return f({},e,{replacement:n})})}(e,n)});return Promise.all(r)}function t(e,n,t){n.lastIndex=0;try{return Promise.resolve(function(e,n,t){return r(function(e,n){for(var r=[],t=n.exec(e);t&&(r.push(t),n.global);)t=n.exec(e);return r}(e,n),t).then(function(n){return function(e,r){return n.reverse().reduce(function(e,n){var r=e.slice(0,n.index),t=e.slice(n.index+n[0].length);return r+n.replacement+t},e)}(e)})}(e,n,t))}catch(e){return Promise.reject(e)}}function u(e,n,r){return void 0===r&&(r=!1),r?e.test(n):n.match(e)}function i(e,n){var r=e.result,t=e.plugins;void 0===t&&(t=[]);return function(e){return new RegExp("<a[^>]*>("+e.source+")<\\/a>","gi")}(n.regex).test(r)||t.filter(function(e){return"url"===e.id}).length}function c(e,n,r){var t=e._services,u=n.id;t.filter(function(e){return e.match===r}).length||t.push({id:u,match:r})}function o(e,n,r,u){return new Promise(function(i,o){var f,s;return s=r,f=s.regex,t(e,f,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new Promise(function(t,i){return a(e,n,r).then(function(o){try{return n._embeds.push({content:o,index:u||e.find(function(e){return"number"==typeof e})}),c(n,r,e[0]),t()}catch(e){return i(e)}},i)})}).then(function(e){try{return i(n)}catch(e){return o(e)}},o)})}function a(e,n,r){var t=this;return new Promise(function(u,i){function c(){return u(a(e,n,r,f))}var o,a,f,s;return s=r,o=s._process,a=s.template,o?o(e,n,r).then(function(e){try{return f=e,c.call(t)}catch(e){return i(e)}},i):c.call(t)})}var f=n,s=/<a[^>]*>([^<]+)<\/a>/gi,l=function(e,n,r){return null==n||n>=e.length?e:(null==r&&(r="..."),e.slice(0,Math.max(0,n-r.length))+r)};e.insert=function(e,n){return new Promise(function(r,l){var h,v,d,m,p;h=e.inlineEmbed;var y;return y=n,v=y._ignoreAnchorCheck,d=y._ignoreInlineCheck,m=y.regex,h||d?new Promise(function(r,o){return i(e,{regex:m})&&!v?function(e,n){return new Promise(function(r,i){var o=e.result,f=e.replaceUrl,l=n.regex,h=n._replaceAnyways;return r(t(o,s,function(r,i){return new Promise(function(o,s){var v,d;return u(l,i,!0)?f||h?o(t(i,l,function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];return new Promise(function(t,u){return c(e,n,r[0]),t(a(r,e,n))})})):(v=function(e,n){e.lastIndex=0;var r=e.exec(n);return e.lastIndex=0,r}(l,i),c(e,n,v[0]),a(v,e,n).then(function(e){try{return d=e,o(v?r+d:r)}catch(e){return s(e)}},s)):o(r)})}))})}(e,n).then(r,o):function(e,n){return new Promise(function(r,u){var i=e.result,o=e.replaceUrl,f=n.regex,s=n._replaceAnyways;return r(t(i,f,function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];return new Promise(function(t,u){return c(e,n,r[0]),new Promise(function(t,u){return o||s?t(a(r,e,n)):a(r,e,n).then(function(e){try{return t(r[0]+" "+e)}catch(e){return u(e)}},u)}).then(t,u)})}))})}(e,n).then(r,o)}).then(function(n){try{return p=n,r(f({},e,{result:p}))}catch(e){return l(e)}},l):r(function(e,n){var r=this;return new Promise(function(a,l){function h(){return a(d)}var v,d,m;return m=n,v=m.regex,d=f({},e),i(d,{regex:v})?t(d.result,s,function(e,r,t){return new Promise(function(i,a){return u(v,e,!0)?(c(d,n,e),o(r,d,n,t).then(function(n){try{return d=n,i(e)}catch(e){return a(e)}},a)):i(e)})}).then(function(e){try{return h.call(r)}catch(e){return l(e)}},l):(d=o(d.result,d,n),h.call(r))})}(e,n))})},e.withDetailsTemplate=function(e,n,r){var t=e.url,u=e.title,i=e.embedUrl,c=e.description,o=e.thumbnail;return void 0===r&&(r=!1),'<div class="ejs-preview ejs-embed"><div class="ejs-thumb '+n+'" data-url="'+i+'" style="background-image:url('+o+')">'+(r?"<span>&#9658;</span>":"")+'</div><div class="ejs-info"><h4 class="ejs-title"><a href="'+t+'">'+u+'</a></h4><div class="ejs-desc">'+l(c,150)+"</div></div></div>"},e.withoutDetailsTemplate=function(e,n,r){return'<iframe class="ejs-embed ejs-'+r+'" src="'+e+'" frameBorder="0" height="'+n+'"></iframe>'},e.getQuery=function(e){var n=encodeURIComponent;return Object.keys(e).map(function(r){return n(r)+"="+n(e[r])}).join("&")},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=embed-plugin-utilities.min.js.map
