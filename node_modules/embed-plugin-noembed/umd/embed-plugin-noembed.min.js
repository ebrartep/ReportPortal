!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.embedPluginNoembed=e()}(this,function(){"use strict";function t(){var e=[].slice.call(arguments),n=!1;"boolean"==typeof e[0]&&(n=e.shift());var r=e[0];if(!r||"object"!=typeof r&&"function"!=typeof r)throw new Error("extendee must be an object");for(var o=e.slice(1),s=o.length,c=0;c<s;c++){var i=o[c];for(var u in i)if(i.hasOwnProperty(u)){var a=i[u];if(n&&function(t){return Array.isArray(t)||"[object Object]"=={}.toString.call(t)}(a)){var p=Array.isArray(a)?[]:{};r[u]=t(!0,r.hasOwnProperty(u)?r[u]:p,a)}else r[u]=a}}return r}function e(t){if(!Array.isArray(t))throw new Error("expected an array");for(var n=[],r=t.length,o=0;o<r;o++){var s=t[o];Array.isArray(s)?n.push.apply(n,e(s)):n.push(s)}return n}function n(t,e){var n=t.map(function(t){return function(t,e){var n=t.concat([t.index,t.input]);return e.apply(null,n).then(function(e){return h({},t,{replacement:e})})}(t,e)});return Promise.all(n)}function r(t,e,r){e.lastIndex=0;try{return Promise.resolve(function(t,e,r){return n(function(t,e){for(var n=[],r=e.exec(t);r&&(n.push(r),e.global);)r=e.exec(t);return n}(t,e),r).then(function(e){return function(t,n){return e.reverse().reduce(function(t,e){var n=t.slice(0,e.index),r=t.slice(e.index+e[0].length);return n+e.replacement+r},t)}(t)})}(t,e,r))}catch(t){return Promise.reject(t)}}function o(t,e,n){return void 0===n&&(n=!1),n?t.test(e):e.match(t)}function s(t,e){var n=t.result,r=t.plugins;void 0===r&&(r=[]);return function(t){return new RegExp("<a[^>]*>("+t.source+")<\\/a>","gi")}(e.regex).test(n)||r.filter(function(t){return"url"===t.id}).length}function c(t,e,n){var r=t._services,o=e.id;r.filter(function(t){return t.match===n}).length||r.push({id:o,match:n})}function i(t,e,n,o){return new Promise(function(s,i){var a,p;return p=n,a=p.regex,r(t,a,function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return new Promise(function(r,s){return u(t,e,n).then(function(i){try{return e._embeds.push({content:i,index:o||t.find(function(t){return"number"==typeof t})}),c(e,n,t[0]),r()}catch(t){return s(t)}},s)})}).then(function(t){try{return s(e)}catch(t){return i(t)}},i)})}function u(t,e,n){var r=this;return new Promise(function(o,s){function c(){return o(u(t,e,n,a))}var i,u,a,p;return p=n,i=p._process,u=p.template,i?i(t,e,n).then(function(t){try{return a=t,c.call(r)}catch(t){return s(t)}},s):c.call(r)})}function a(t,e){var n=e.fetch;return new Promise(function(e,r){var o,s;o=t[0];var c=function(t){try{return e({html:o})}catch(t){return r(t)}};try{return n("https://noembed.com/embed?url="+o).then(function(t){try{return(s=t).json().then(e,c)}catch(t){return c()}},c)}catch(t){c()}})}function p(t){void 0===t&&(t={});var e={id:x,regex:null,exclude:[],twttr:m?window.twttr:null,onLoad:function(){},template:function(t,e,n,r){var o=r.html;return new Promise(function(t,e){return t('<div class="ejs-embed">'+o+"</div>")})},_onLoadInternal:function(t,e){var n=t.input,r=t.result,o=e.twttr,s=e.onLoad;(function(t,e){var n=v.filter(function(e){return e.name.toLowerCase()===t})[0];return new RegExp(n.patterns.join("|"),"gi").test(e)})("twitter",r)&&o&&d(n)&&(o.widgets.load(n),o.events.bind("loaded",s))}},n=h({},e,t,{_process:a});return t.regex||(n.regex=function(t){void 0===t&&(t=[]);var e=v.filter(function(e){return-1===t.indexOf(e.name.toLowerCase())}),n=w(l(e,"patterns"));return new RegExp(n.join("|"),"gi")}(n.exclude)),b(n)}var h=t,f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m="object"===("undefined"==typeof window?"undefined":f(window))&&"object"===("undefined"==typeof document?"undefined":f(document))&&9===document.nodeType,d=function(t){return!(!t||"object"!=typeof t)&&("object"==typeof window&&"object"==typeof window.Node?t instanceof window.Node:"number"==typeof t.nodeType&&"string"==typeof t.nodeName)},l=function(t,e){if(!t||"object"!=typeof t)return new Error("expected first argument to be an object or array");var n,r,o,s,c;if(Array.isArray(t))for(n=[],r=t.length,o=0;o<r;o++)n.push(t[o][e]);else for(n={},r=(s=Object.keys(t)).length,o=0;o<r;o++)n[c=s[o]]=t[c][e];return n},w=e,v=[{patterns:["https?://soundcloud.com/.*/.[^\\s]*"],name:"SoundCloud"},{name:"slideshare",patterns:["https?://www\\.slideshare\\.net/.*/.[^\\s]*","https?://fr\\.slideshare\\.net/.*/.[^\\s]*","https?://de\\.slideshare\\.net/.*/.[^\\s]*","https?://es\\.slideshare\\.net/.*/.[^\\s]*","https?://pt\\.slideshare\\.net/.*/.[^\\s]*"]},{name:"vimeo",patterns:["https?://vimeo\\.com/.[^\\s]*","https?://vimeo\\.com/album/.*/video/.[^\\s]*","https?://vimeo\\.com/channels/.*/.[^\\s]*","https?://vimeo\\.com/groups/.*/videos/.[^\\s]*","https?://vimeo\\.com/ondemand/.*/.[^\\s]*"]},{patterns:["https?://photos\\.app\\.net/.*/.[^\\s]*","https?://live\\.amcharts\\.com/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://www\\.collegehumor\\.com/video/.[^\\s]*","https?://www\\.dailymotion\\.com/video/.[^\\s]*","https?://.*\\.deviantart\\.com/art/.[^\\s]*","https?://.*\\.deviantart\\.com/.*#/d.[^\\s]*","https?://dotsub\\.com/view/.[^\\s]*","https?://.*\\.flickr\\.com/photos/.[^\\s]*","https?://flic\\.kr/p/.[^\\s]*","https?://.*\\.wikimedia\\.org/.*_geograph\\.org\\.uk_.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://giphy\\.com/gifs/.[^\\s]*","https?://media\\.giphy\\.com/media/.*/giphy\\.gif","https?://www\\.hulu\\.com/watch/.[^\\s]*","https?://www\\.kickstarter\\.com/projects/.[^\\s]*","https?://www\\.mixcloud\\.com/.*/.*/","https?://reddit\\.com/r/.*/comments/.*/.[^\\s]*","https?://.*\\.screen9\\.tv/.[^\\s]*","https?://www\\.scribd\\.com/doc/.[^\\s]*","https?://.*\\.smugmug\\.com/.[^\\s]*","https?://soundcloud\\.com/.[^\\s]*","https?://play\\.soundsgood\\.co/playlist/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://ted\\.com/talks/.[^\\s]*","https?://www\\.nytimes\\.com/svc/oembed","https?://nytimes\\.com/.[^\\s]*","https?://.*\\.nytimes\\.com/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://.*\\.ustream\\.tv/.[^\\s]*","https?://.*\\.ustream\\.com/.[^\\s]*","https?://veervr\\.tv/videos/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://player\\.vimeo\\.com/video/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*"],name:"oEmbed"},{name:"Imgur",patterns:["https?://imgur\\.com/(?:[^\\/]+/)?[0-9a-zA-Z]+$"]},{patterns:["https?://www\\.(dropbox\\.com/s/.+\\.(?:jpg|png|gif))","https?://db\\.tt/[a-zA-Z0-9][^\\s]+"],name:"Dropbox"},{patterns:["https?:\\/\\/(?:[^\\.]+\\.)?youtube\\.com\\/watch\\/?\\?(?:.+&)?v=([^&][^\\s]+)","https?://(?:[^\\.]+\\.)?(?:youtu\\.be|youtube\\.com/embed)/([a-zA-Z0-9_-][^\\s]+)"],name:"YouTube"},{patterns:["https?://(?:www|mobile\\.)?twitter\\.com/(?:#!/)?([^/]+)/status(?:es)?/(\\d+)"],name:"Twitter"}],y=/<a[^>]*>([^<]+)<\/a>/gi,g=function(t,e){return new Promise(function(n,a){var p,f,m,d,l;p=t.inlineEmbed;var w;return w=e,f=w._ignoreAnchorCheck,m=w._ignoreInlineCheck,d=w.regex,p||m?new Promise(function(n,i){return s(t,{regex:d})&&!f?function(t,e){return new Promise(function(n,s){var i=t.result,a=t.replaceUrl,p=e.regex,h=e._replaceAnyways;return n(r(i,y,function(n,s){return new Promise(function(i,f){var m,d;return o(p,s,!0)?a||h?i(r(s,p,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return c(t,e,n[0]),r(u(n,t,e))})})):(m=function(t,e){t.lastIndex=0;var n=t.exec(e);return t.lastIndex=0,n}(p,s),c(t,e,m[0]),u(m,t,e).then(function(t){try{return d=t,i(m?n+d:n)}catch(t){return f(t)}},f)):i(n)})}))})}(t,e).then(n,i):function(t,e){return new Promise(function(n,o){var s=t.result,i=t.replaceUrl,a=e.regex,p=e._replaceAnyways;return n(r(s,a,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return c(t,e,n[0]),new Promise(function(r,o){return i||p?r(u(n,t,e)):u(n,t,e).then(function(t){try{return r(n[0]+" "+t)}catch(t){return o(t)}},o)}).then(r,o)})}))})}(t,e).then(n,i)}).then(function(e){try{return l=e,n(h({},t,{result:l}))}catch(t){return a(t)}},a):n(function(t,e){var n=this;return new Promise(function(u,a){function p(){return u(m)}var f,m,d;return d=e,f=d.regex,m=h({},t),s(m,{regex:f})?r(m.result,y,function(t,n,r){return new Promise(function(s,u){return o(f,t,!0)?(c(m,e,t),i(n,m,e,r).then(function(e){try{return m=e,s(t)}catch(t){return u(t)}},u)):s(t)})}).then(function(t){try{return p.call(n)}catch(t){return a(t)}},a):(m=i(m.result,m,e),p.call(n))})}(t,e))})},b=function(t){var e=h({},{_replaceAnyways:!1,_ignoreAnchorCheck:!1,_ignoreInlineCheck:!1,onLoad:function(){}},t),n=e._onLoadInternal,r=e.onLoad,o=e.regex,s=e.template,c=e.id;if(!o)throw new Error("regex not passed.");if(!s)throw new Error("template not passed.");return{id:c,transform:function(t){return new Promise(function(n,r){return g(t,e).then(function(e){try{return n(h({},t,e))}catch(t){return r(t)}},r)})},onLoad:function(t){n&&n(t,e),r&&r(t,e)}}},x="noEmbed";return p.id=x,p});
//# sourceMappingURL=embed-plugin-noembed.min.js.map
